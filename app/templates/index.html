{% extends "base.html" %}

{% block title %}KI-Forms{% endblock %}

{% block content %}


<!-- Container 1: Formularauswahl -->
<div class="card shadow-sm mb-4">
    <div class="card-body">
        <div class="form-selection-wrapper">
            <div class="form-selection-left">
                <h2 class="card-title mb-3">Formular auswählen</h2>
                <select class="form-select form-select-lg" id="formSelect">
                    <option value="">-- Formular wählen --</option>
                    {% for form_id, form_def in forms.items() %}
                    <option value="{{ form_id }}"
                            data-title="{{ form_def.form_title }}"
                            data-fields="{{ form_def.fields | length }}"
                            {% if completed_form == form_id %}selected{% endif %}>
                        {{ form_id }} &mdash; {{ form_def.form_title }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            <div class="thumbnail-container">
                <img id="formThumbnail" class="form-thumbnail d-none" alt="Formularvorschau">
            </div>
        </div>
    </div>
</div>

<!-- Container 2: Upload & Aktionen -->
<div class="card shadow-sm mb-4" id="uploadSection">
    <div class="card-body">
        <h2 class="card-title mb-3">Dokumente hochladen</h2>
        <p class="text-muted">
            Laden Sie die PDF-Dokumente hoch, aus denen das Formular ausgefüllt werden soll
            (z.B. Arztbriefe, Befundberichte, Entlassungsbriefe).
        </p>

        <form id="uploadForm" method="post" enctype="multipart/form-data">
            <div class="upload-zone mb-3" id="dropZone">
                <i class="bi bi-cloud-arrow-up"></i>
                <p class="mt-2 mb-1 fw-bold">PDF-Dateien hierher ziehen</p>
                <p class="text-muted mb-0">oder klicken zum Auswählen</p>
                <input type="file" name="files" id="fileInput" multiple accept=".pdf"
                       class="d-none">
            </div>

            <div id="fileList" class="mb-3"></div>

            <div class="alert alert-info d-flex align-items-center gap-2" role="alert">
                <i class="bi bi-info-circle"></i>
                <span>Unterstützte Formate: PDF (auch gescannte Dokumente mit OCR-Erkennung).
                Maximal 10 Dateien, je max. 50 MB.</span>
            </div>


            <div class="d-flex flex-wrap gap-2">
                <button type="submit" class="btn btn-primary btn-execute" id="submitBtn" disabled>
                    <i class="bi bi-cpu"></i> Ausführen
                </button>

                {% if download_url %}
                <a href="{{ download_url }}" class="btn btn-success btn-lg" id="downloadBtn" download>
                    <i class="bi bi-download"></i> Download
                </a>
                <a href="{{ download_url }}" class="btn btn-outline-secondary btn-lg" id="printBtn" target="_blank">
                    <i class="bi bi-printer"></i> Drucken
                </a>
                {% endif %}
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/upload.js"></script>
{% endblock %}
